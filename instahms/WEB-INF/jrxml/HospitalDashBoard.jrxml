<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="hospitaldashboard" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="535" leftMargin="30" rightMargin="30" topMargin="40" bottomMargin="40">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="fromdate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="todate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false"/>
	<queryString>
		<![CDATA[SELECT 0 as no,sum(bc.amount) as rev, b.visit_type,dep.dept_name
FROM bill_charge bc JOIN bill b on  bc.bill_no=b.bill_no  and b.status!='X' and bc.status!='X'
LEFT JOIN department dep on  dep.dept_id=bc.act_department_id
WHERE date(bc.posted_date) between  '$P!{fromdate}' and  '$P!{todate}'
 group by b.visit_type, dep.dept_name
UNION
SELECT count(pr.patient_id) as no,0 as rev, pr.visit_type, dep.dept_name
FROM patient_registration pr  
LEFT  JOIN department dep on dep.dept_id=  pr.dept_name
WHERE (pr.reg_date) between   '$P!{fromdate}' and   '$P!{todate}'
GROUP by pr.visit_type, dep.dept_name
UNION
SELECT count(isr.incoming_visit_id) as no,0 as rev, b.visit_type,dep.dept_name
FROM incoming_sample_registration isr
JOIN department dep on (dep.dept_id = isr.category)
LEFT OUTER JOIN bill b on b.visit_id = isr.incoming_visit_id
WHERE date(isr.date)  between  '$P!{fromdate}' and  '$P!{todate}'
GROUP by b.visit_type,dep.dept_name
UNION
SELECT count(prc.customer_id) as no,0 as rev ,'r' as visit_type,  'Pharmacy' as dept_name
FROM pharmacy_retail_customers prc
where date(prc.visit_date)  between '$P!{fromdate}' and  '$P!{todate}']]>
	</queryString>
	<field name="no" class="java.lang.Long"/>
	<field name="rev" class="java.math.BigDecimal"/>
	<field name="visit_type" class="java.lang.String"/>
	<field name="dept_name" class="java.lang.String"/>
	<group name="nodata">
		<groupExpression><![CDATA[]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band height="20">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT}.intValue()==0?Boolean.TRUE:Boolean.FALSE]]></printWhenExpression>
				<staticText>
					<reportElement key="staticText-3" x="0" y="0" width="535" height="19">
						<printWhenExpression><![CDATA[$V{REPORT_COUNT}.intValue()==0?Boolean.TRUE:Boolean.FALSE]]></printWhenExpression>
					</reportElement>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[NO DATA]]></text>
				</staticText>
			</band>
		</groupFooter>
	</group>
	<group name="collectionreport">
		<groupExpression><![CDATA[]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<group name="dashboard">
		<groupExpression><![CDATA[]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band height="30">
				<subreport isUsingCache="true">
					<reportElement key="subreport-2" x="-17" y="0" width="243" height="30"/>
					<subreportParameter name="fromdate">
						<subreportParameterExpression><![CDATA[$P{fromdate}]]></subreportParameterExpression>
					</subreportParameter>
					<subreportParameter name="todate">
						<subreportParameterExpression><![CDATA[$P{todate}]]></subreportParameterExpression>
					</subreportParameter>
					<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					<subreportExpression class="java.lang.String"><![CDATA[$P{SUBREPORT_DIR}+"/HospitalDashboardCollection.jasper"]]></subreportExpression>
				</subreport>
			</band>
		</groupFooter>
	</group>
	<background>
		<band/>
	</background>
	<title>
		<band height="44">
			<staticText>
				<reportElement key="staticText-1" x="0" y="-1" width="535" height="25"/>
				<box>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Dash board of Hospital Operations]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="328" y="24" width="65" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{todate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="153" y="24" width="60" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[From Date:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="213" y="24" width="65" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{fromdate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="278" y="24" width="50" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[To Date:]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band/>
	</pageHeader>
	<columnHeader>
		<band/>
	</columnHeader>
	<detail>
		<band/>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band/>
	</pageFooter>
	<summary>
		<band height="160">
			<crosstab>
				<reportElement key="crosstab-1" x="0" y="50" width="535" height="108"/>
				<crosstabHeaderCell>
					<cellContents>
						<staticText>
							<reportElement key="staticText-4" x="0" y="25" width="100" height="25"/>
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textElement textAlignment="Left" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<text><![CDATA[DEPARTMENT]]></text>
						</staticText>
					</cellContents>
				</crosstabHeaderCell>
				<rowGroup name="dept_name" width="100" totalPosition="End">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{dept_name}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents>
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="100" height="30"/>
								<textElement textAlignment="Left" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{dept_name}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents>
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="100" height="30"/>
								<textElement textAlignment="Left" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA["Total "]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="visit_type" height="25" totalPosition="End" headerPosition="Center">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{visit_type}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents/>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents/>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<columnGroup name="visit_type1" height="25" totalPosition="End" headerPosition="Center">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{visit_type}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents>
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="50" height="25"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{visit_type1}.equalsIgnoreCase("i")?" IP Count":
$V{visit_type1}.equalsIgnoreCase("o")?" OP Count ":
$V{visit_type1}.equalsIgnoreCase("d")?" Diag Count ":
$V{visit_type1}.equalsIgnoreCase("t")?" InComing Test Count ":
$V{visit_type1}.equalsIgnoreCase("r")?"Retail Count": " "]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents>
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="50" height="25"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{visit_type}.equalsIgnoreCase("i")?" IP Rev ":
$V{visit_type}.equalsIgnoreCase("o")?" OP Rev ":
$V{visit_type}.equalsIgnoreCase("d")?" Diag Rev ":
$V{visit_type}.equalsIgnoreCase("t")?" InComing Test Rev ":
"Retail Rev"]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="no_Sum" class="java.lang.Long" calculation="Sum">
					<measureExpression><![CDATA[$F{no}]]></measureExpression>
				</measure>
				<measure name="amount" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{rev}]]></measureExpression>
				</measure>
				<crosstabCell width="50" height="30">
					<cellContents>
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="50" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.lang.Long"><![CDATA[$V{no_Sum}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="50" height="30" columnTotalGroup="visit_type1">
					<cellContents>
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="#,##0.00" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="50" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{amount}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="0" height="30" columnTotalGroup="visit_type">
					<cellContents/>
				</crosstabCell>
				<crosstabCell width="50" height="30" rowTotalGroup="dept_name">
					<cellContents>
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="50" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.lang.Long"><![CDATA[$V{no_Sum}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="50" height="30" rowTotalGroup="dept_name" columnTotalGroup="visit_type1">
					<cellContents>
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="#,##0.00" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="50" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{amount}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="0" height="30" rowTotalGroup="dept_name" columnTotalGroup="visit_type">
					<cellContents/>
				</crosstabCell>
				<whenNoDataCell>
					<cellContents/>
				</whenNoDataCell>
			</crosstab>
			<staticText>
				<reportElement key="staticText-2" x="0" y="20" width="535" height="26"/>
				<textElement/>
				<text><![CDATA[Note :-	 1. Count   is based on Registration Date
          	  2. Revenue is based on Charge Posted Date]]></text>
			</staticText>
			<staticText>
				<reportElement key="staticText-4" x="0" y="0" width="535" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" isUnderline="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Hospital Revenue]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
