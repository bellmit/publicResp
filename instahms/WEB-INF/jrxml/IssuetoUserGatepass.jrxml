<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="pharmacystockissue" pageWidth="480" pageHeight="842" columnWidth="420" leftMargin="30" rightMargin="30" topMargin="40" bottomMargin="40">
	<parameter name="issNo" class="java.lang.String"/>
	<parameter name="hospital" class="java.lang.String"/>
	<queryString>
		<![CDATA[select s.dept_name as from_store,
	sitd.medicine_name as item_name,
	sid.batch_no as item_identifier,
	to_char(sim.date_time, 'DD-MM-YYYY HH:MI AM')as date,
	sim.username,
	sid.qty,
	sim.reference ,
	sid.user_issue_no,
	sim.user_type,
	sim.issued_to,
	coalesce(pd.patient_name,'') as patient_name,
	b.bill_no,
	round((amount*sid.qty),2) as amount,
              case when issue_type='P' then 'Permanent' when issue_type='C' then 'Consumable' else 'Reusable' end as issue_type,
	case when consignment_stock='t' then 'Consignment' else 'Normal' end as stocktype,
	case when issue_type='L' then 'Returnable' else 'Non-Returnable' end as returntype
from stock_issue_main sim
join stock_issue_details sid using(user_issue_no)
left outer join patient_details pd on pd.mr_no=sim.issued_to
join  store_item_details  sitd  on(sitd.medicine_id=sid.medicine_id)
join store_category_master scm on (scm.category_id=sitd.med_category_id)
join stores s on(s.dept_id = sim.dept_from)
join store_stock_details ssd on (ssd.dept_id=dept_from and ssd.medicine_id=sid.medicine_id and sid.batch_no=ssd.batch_no)
left join patient_registration pr on (pd.mr_no=pr.mr_no and pr.status='A')
left join bill b on (b.visit_id=pr.patient_id and b.bill_type='C')
where  sid.user_issue_no='$P!{issNo}']]>
	</queryString>
	<field name="from_store" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="item_name" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="item_identifier" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="date" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="username" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="qty" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="reference" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="user_issue_no" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="user_type" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="bill_no" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="issued_to" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="patient_name" class="java.lang.String"/>
	<field name="issue_type" class="java.lang.String"/>
	<field name="stocktype" class="java.lang.String"/>
	<field name="amount" class="java.lang.Number"/>
	<field name="returntype" class="java.lang.String"/>
	<variable name="total" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{amount}]]></variableExpression>
	</variable>
	<group name="fromstore">
		<groupHeader>
			<band height="78">
				<staticText>
					<reportElement key="staticText-13" x="129" y="5" width="57" height="20"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="false" pdfFontName="Helvetica"/>
					</textElement>
					<text><![CDATA[From Store:]]></text>
				</staticText>
				<textField isBlankWhenNull="false">
					<reportElement key="textField-3" x="184" y="5" width="99" height="20"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{from_store}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="3" y="5" width="50" height="20"/>
					<box leftPadding="2"/>
					<textElement verticalAlignment="Middle"/>
					<text><![CDATA[Issue No:]]></text>
				</staticText>
				<textField>
					<reportElement x="57" y="5" width="45" height="20"/>
					<box leftPadding="2"/>
					<textElement verticalAlignment="Middle">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{issNo}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement key="staticText-6" mode="Transparent" x="290" y="6" width="65" height="20" backcolor="#FFFFFF"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="false" pdfFontName="Helvetica"/>
					</textElement>
					<text><![CDATA[Issue Date:]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" pattern="dd/MM" isBlankWhenNull="true">
					<reportElement key="textField" stretchType="RelativeToTallestObject" x="344" y="8" width="56" height="20"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{date}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement key="staticText-9" mode="Transparent" x="3" y="31" width="51" height="20" backcolor="#FFFFFF"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" lineSpacing="Single">
						<font size="9" isBold="false" pdfFontName="Helvetica"/>
					</textElement>
					<text><![CDATA[Reason :]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement key="textField" x="52" y="33" width="348" height="20"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{reference}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="80">
				<staticText>
					<reportElement x="2" y="56" width="100" height="20"/>
					<textElement textAlignment="Center"/>
					<text><![CDATA[Signature of Issuer]]></text>
				</staticText>
				<staticText>
					<reportElement x="157" y="49" width="100" height="27"/>
					<textElement textAlignment="Center"/>
					<text><![CDATA[Signature of Person
Collecting the Store]]></text>
				</staticText>
				<staticText>
					<reportElement x="315" y="54" width="100" height="20"/>
					<textElement textAlignment="Center"/>
					<text><![CDATA[Counter Signature]]></text>
				</staticText>
				<line>
					<reportElement x="3" y="53" width="100" height="1"/>
				</line>
				<line>
					<reportElement x="154" y="47" width="100" height="1"/>
				</line>
				<line>
					<reportElement x="316" y="52" width="100" height="1"/>
				</line>
			</band>
		</groupFooter>
	</group>
	<group name="issueheader">
		<groupHeader>
			<band height="29">
				<staticText>
					<reportElement key="staticText-4" mode="Opaque" x="30" y="0" width="120" height="24" backcolor="#FFFFFF"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[Item Name]]></text>
				</staticText>
				<staticText>
					<reportElement key="staticText-5" mode="Opaque" x="117" y="0" width="76" height="24" backcolor="#FFFFFF"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[Batch/Sl No]]></text>
				</staticText>
				<staticText>
					<reportElement key="staticText-7" mode="Opaque" x="191" y="0" width="45" height="24" backcolor="#FFFFFF"/>
					<box leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[User]]></text>
				</staticText>
				<staticText>
					<reportElement key="staticText-8" mode="Opaque" x="255" y="0" width="50" height="24" backcolor="#FFFFFF"/>
					<box rightPadding="1"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[Qty]]></text>
				</staticText>
				<staticText>
					<reportElement key="staticText-24" mode="Opaque" x="0" y="4" width="30" height="24" backcolor="#FFFFFF"/>
					<box topPadding="2" leftPadding="2"/>
					<textElement textAlignment="Left" verticalAlignment="Top">
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[Si No
]]></text>
				</staticText>
				<line>
					<reportElement x="0" y="-4" width="370" height="1"/>
				</line>
				<staticText>
					<reportElement x="321" y="5" width="31" height="20"/>
					<textElement>
						<font size="9" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[MRP]]></text>
				</staticText>
				<line>
					<reportElement x="0" y="26" width="370" height="1"/>
				</line>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="30">
				<line>
					<reportElement x="304" y="2" width="70" height="1"/>
				</line>
				<staticText>
					<reportElement x="282" y="6" width="37" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Total :
]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" evaluationTime="Report">
					<reportElement x="324" y="6" width="71" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{total}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band/>
	</background>
	<title>
		<band height="80">
			<staticText>
				<reportElement key="staticText" x="138" y="39" width="118" height="31"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center">
					<font size="15" isBold="true"/>
				</textElement>
				<text><![CDATA[Gate Pass]]></text>
			</staticText>
			<textField>
				<reportElement x="113" y="5" width="168" height="31"/>
				<textElement textAlignment="Center">
					<font size="24" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{hospital}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="291" y="44" width="35" height="20"/>
				<textElement/>
				<text><![CDATA[Date:]]></text>
			</staticText>
			<line>
				<reportElement x="322" y="57" width="93" height="1"/>
			</line>
		</band>
	</title>
	<pageHeader>
		<band height="45">
			<staticText>
				<reportElement x="4" y="4" width="206" height="15"/>
				<textElement/>
				<text><![CDATA[Following Items are permitted to pass out]]></text>
			</staticText>
			<textField>
				<reportElement x="211" y="19" width="100" height="20"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{issued_to}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="4" y="19" width="94" height="20"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{returntype}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="80" y="19" width="128" height="20"/>
				<textElement/>
				<text><![CDATA[item Consigned to M/s.]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band/>
	</columnHeader>
	<detail>
		<band height="22">
			<rectangle>
				<reportElement key="" mode="Opaque" x="0" y="0" width="490" height="20" forecolor="#FFFFFF" backcolor="#FFFFFF">
					<printWhenExpression><![CDATA[new Boolean(($V{issueheader_COUNT}.intValue()%2) == 0)]]></printWhenExpression>
				</reportElement>
			</rectangle>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement key="textField" stretchType="RelativeToTallestObject" mode="Transparent" x="30" y="0" width="87" height="20"/>
				<box leftPadding="2"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{item_name}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" stretchType="RelativeToTallestObject" x="121" y="0" width="76" height="20"/>
				<box leftPadding="2"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{item_identifier}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement key="textField" stretchType="RelativeToTallestObject" x="187" y="0" width="81" height="20"/>
				<box leftPadding="2"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{username}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField" stretchType="RelativeToTallestObject" x="257" y="0" width="50" height="20"/>
				<box leftPadding="2"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.lang.Number"><![CDATA[$F{qty}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField-61" x="0" y="0" width="30" height="20"/>
				<box topPadding="2" leftPadding="2" rightPadding="2"/>
				<textElement verticalAlignment="Middle">
					<font size="10" pdfFontName="Helvetica"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement key="textField" x="323" y="1" width="50" height="19"/>
				<textElement/>
				<textFieldExpression class="java.lang.Number"><![CDATA[$F{amount}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band/>
	</pageFooter>
	<lastPageFooter>
		<band/>
	</lastPageFooter>
	<summary>
		<band/>
	</summary>
</jasperReport>
