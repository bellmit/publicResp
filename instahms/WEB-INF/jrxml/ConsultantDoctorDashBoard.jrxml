<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ConsultantDoctorDashBoard" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="535" leftMargin="30" rightMargin="30" topMargin="40" bottomMargin="40">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="fromdate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="todate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="doctorId" class="java.lang.String" isForPrompting="false"/>
	<queryString>
		<![CDATA[SELECT 0 as no,sum(bc.amount) as rev, case when pr.visit_type='i' then 'i' when pr.visit_type='o'
 then (case when pr.revisit='N' then 'o' when pr.revisit='Y' then 'F' end ) end as visit_type,
doc.doctor_name 
FROM bill_charge bc JOIN bill b on   bc.bill_no=b.bill_no  and  b.status!='X' and bc.status!='X' 
left JOIN patient_registration pr ON b.visit_id=pr.patient_id  
join doctors doc on  doc.doctor_id=pr.doctor and doc.doctor_type like 'CON%'  
where date_trunc('day',bc.posted_date) >= '$P!{fromdate}' and date_trunc('day',bc.posted_date) <= '$P!{todate}' and doc.doctor_id in($P!{doctorId})
group  by pr.visit_type,doc.doctor_name ,pr.revisit
union  
SELECT count(pr.patient_id) as no,0 as rev,case when pr.visit_type='i' then 'i' when pr.visit_type='o'
 then (case when pr.revisit='N' then 'o' when pr.revisit='Y' then 'F' end ) end as visit_type , doc.doctor_name 
FROM patient_registration pr   
join doctors doc on doc.doctor_id=pr.doctor and doc.doctor_type like 'CON%' 
WHERE date_trunc('day',pr.reg_date) >= '$P!{fromdate}' and date_trunc('day',pr.reg_date) <= '$P!{todate}'
and doc.doctor_id in($P!{doctorId})
group by pr.visit_type,doc.doctor_name,pr.revisit order by doctor_name]]>
	</queryString>
	<field name="no" class="java.lang.Long">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="rev" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="visit_type" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="doctor_name" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<group name="nodata">
		<groupExpression><![CDATA[]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band height="19">
				<printWhenExpression><![CDATA[$V{REPORT_COUNT}.intValue()==0?Boolean.TRUE:Boolean.FALSE]]></printWhenExpression>
				<staticText>
					<reportElement key="staticText-3" x="0" y="0" width="535" height="19">
						<printWhenExpression><![CDATA[$V{REPORT_COUNT}.intValue()==0?Boolean.TRUE:Boolean.FALSE]]></printWhenExpression>
					</reportElement>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[NO DATA]]></text>
				</staticText>
			</band>
		</groupFooter>
	</group>
	<group name="collectionreport">
		<groupExpression><![CDATA[]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<group name="dashboard">
		<groupExpression><![CDATA[]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<background>
		<band/>
	</background>
	<title>
		<band height="45">
			<staticText>
				<reportElement key="staticText-1" x="0" y="0" width="535" height="25"/>
				<box>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Dash board - Doctors Revenue ]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="220" y="25" width="65" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{fromdate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="160" y="25" width="60" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[From Date:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="335" y="25" width="65" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{todate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="285" y="25" width="50" height="20"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[To Date:]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band/>
	</pageHeader>
	<columnHeader>
		<band/>
	</columnHeader>
	<detail>
		<band/>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band/>
	</pageFooter>
	<summary>
		<band height="160">
			<crosstab>
				<reportElement key="crosstab-1" mode="Transparent" x="0" y="50" width="535" height="108"/>
				<crosstabHeaderCell>
					<cellContents mode="Transparent">
						<staticText>
							<reportElement key="staticText-4" x="0" y="25" width="100" height="25"/>
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textElement textAlignment="Left" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<text><![CDATA[Doctor Name]]></text>
						</staticText>
					</cellContents>
				</crosstabHeaderCell>
				<rowGroup name="doctor_name" width="100" totalPosition="End">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{doctor_name}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Transparent">
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="100" height="30"/>
								<textElement textAlignment="Left" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{doctor_name}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Transparent">
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="100" height="30"/>
								<textElement textAlignment="Left" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA["Total "]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="visit_type" height="25" totalPosition="End" headerPosition="Center">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{visit_type}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Transparent"/>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents/>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<columnGroup name="visit_type1" height="25" totalPosition="End" headerPosition="Center">
					<bucket>
						<bucketExpression class="java.lang.String"><![CDATA[$F{visit_type}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Transparent">
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="65" height="25"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{visit_type1}.equalsIgnoreCase("i")?" IP Count":
$V{visit_type1}.equalsIgnoreCase("o")?" New Out Patient Count ":
$V{visit_type1}.equalsIgnoreCase("d")?" Diag Count ":
$V{visit_type1}.equalsIgnoreCase("F")?" Follow on Out Patient Count ":" "]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents mode="Transparent">
							<box>
								<topPen lineWidth="0.25"/>
								<leftPen lineWidth="0.25"/>
								<bottomPen lineWidth="0.25"/>
								<rightPen lineWidth="0.25"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement key="textField" x="0" y="0" width="65" height="25"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font size="9" pdfFontName="Helvetica"/>	
								</textElement>
								<textFieldExpression class="java.lang.String"><![CDATA[$V{visit_type}.equalsIgnoreCase("i")?" IP Rev ":
$V{visit_type}.equalsIgnoreCase("o")?" New Out Patient Rev ":
$V{visit_type}.equalsIgnoreCase("d")?" Diag Rev ":
$V{visit_type}.equalsIgnoreCase("F")?" Follow on Out Patient Rev ":" "]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="no_Sum" class="java.lang.Long" calculation="Sum">
					<measureExpression><![CDATA[$F{no}]]></measureExpression>
				</measure>
				<measure name="amount" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{rev}]]></measureExpression>
				</measure>
				<crosstabCell width="65" height="30">
					<cellContents mode="Transparent">
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="65" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.lang.Long"><![CDATA[$V{no_Sum}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="65" height="30" columnTotalGroup="visit_type1">
					<cellContents mode="Transparent">
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="#,##0.00" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="65" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{amount}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="0" height="30" columnTotalGroup="visit_type">
					<cellContents mode="Transparent"/>
				</crosstabCell>
				<crosstabCell width="65" height="30" rowTotalGroup="doctor_name">
					<cellContents mode="Transparent">
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="65" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.lang.Long"><![CDATA[$V{no_Sum}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="65" height="30" rowTotalGroup="doctor_name" columnTotalGroup="visit_type1">
					<cellContents mode="Transparent">
						<box>
							<topPen lineWidth="0.25"/>
							<leftPen lineWidth="0.25"/>
							<bottomPen lineWidth="0.25"/>
							<rightPen lineWidth="0.25"/>
						</box>
						<textField isStretchWithOverflow="true" pattern="#,##0.00" isBlankWhenNull="true">
							<reportElement key="textField" x="0" y="0" width="65" height="30"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font size="9" pdfFontName="Helvetica"/>	
							</textElement>
							<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{amount}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="0" height="30" rowTotalGroup="doctor_name" columnTotalGroup="visit_type">
					<cellContents mode="Transparent"/>
				</crosstabCell>
				<whenNoDataCell>
					<cellContents mode="Transparent"/>
				</whenNoDataCell>
			</crosstab>
			<staticText>
				<reportElement key="staticText-2" x="0" y="18" width="535" height="26"/>
				<textElement/>
				<text><![CDATA[Note :-	 1. Count   is based on Registration Date
          	  2. Revenue is based on Charge Posted Date]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
