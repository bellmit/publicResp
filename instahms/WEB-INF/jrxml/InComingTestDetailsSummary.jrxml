<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report name" pageWidth="595" pageHeight="842" whenNoDataType="NoDataSection" columnWidth="535" leftMargin="20" rightMargin="20" topMargin="40" bottomMargin="40">
	<parameter name="fromDate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="toDate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="testStatusArray" class="java.lang.String[]" isForPrompting="false">
		<defaultValueExpression><![CDATA[new String[]{}]]></defaultValueExpression>
	</parameter>
	<parameter name="hospIdArray" class="java.lang.String[]" isForPrompting="false">
		<defaultValueExpression><![CDATA[new String[]{}]]></defaultValueExpression>
	</parameter>
	<parameter name="categoryArray" class="java.lang.String[]" isForPrompting="false">
		<defaultValueExpression><![CDATA[new String[]{}]]></defaultValueExpression>
	</parameter>
	<parameter name="center" class="java.lang.String" isForPrompting="false"/>
	<queryString>
		<![CDATA[select bill_no,patient_name,sum(amount) as amount,hospital_name,conducted,date,
			hospital_id,category,center_id
			FROM (
			SELECT bc.bill_no,patient_name,amount,hospital_name,tp.conducted,date,hospital_id,
				dd.category,isr.center_id
					FROM incoming_sample_registration isr
					JOIN tests_prescribed tp on tp.pat_id = isr.incoming_visit_id
					JOIN bill_charge bc on bc.bill_no = isr.billno and charge_group like 'DIA'
					JOIN bill_activity_charge bac on (bac.charge_id=bc.charge_id)and (tp.prescribed_id::varchar=bac.activity_id)
					JOIN incoming_hospitals ih on ih.hospital_id = isr.orig_lab_name
					JOIN diagnostics d on (d.test_id=tp.test_id)
					JOIN diagnostics_departments dd on (dd.ddept_id = d.ddept_id )

					UNION ALL

					SELECT bc.bill_no,patient_name,amount,hospital_name,'U' as conducted,date,hospital_id,
					'DEP_LAB' as category,isr.center_id
					FROM incoming_sample_registration isr
					JOIN package_prescribed pp on (pp.patient_id = isr.incoming_visit_id)
					JOIN bill_charge bc on bc.bill_no = isr.billno and charge_group like 'PKG'
					JOIN bill_activity_charge bac on (bac.charge_id=bc.charge_id)and (pp.prescription_id::varchar=bac.activity_id)
					JOIN incoming_hospitals ih on ih.hospital_id = isr.orig_lab_name
			)as foo
			WHERE conducted != 'X' AND date(date) BETWEEN  $P{fromDate}  AND   $P{toDate}   AND
					$X{IN, conducted, testStatusArray}
					AND $X{IN, hospital_id ,hospIdArray} AND $X{IN, category ,categoryArray}
					AND ( 0 = $P!{center} OR $P!{center} = center_id )
			GROUP BY bill_no,hospital_name,patient_name,conducted,date,hospital_id,category,center_id
			ORDER BY hospital_name
		]]>
	</queryString>
	<field name="patient_name" class="java.lang.String"/>
	<field name="hospital_name" class="java.lang.String"/>
	<field name="date" class="java.sql.Timestamp"/>
	<field name="amount" class="java.math.BigDecimal"/>
	<field name="conducted" class="java.lang.String"/>
	<variable name="hosp_sub_total" class="java.math.BigDecimal" resetType="Group" resetGroup="hospitalName" calculation="Sum">
		<variableExpression><![CDATA[$F{conducted}.equals( "Cancel")?new BigDecimal(0):$F{amount}]]></variableExpression>
	</variable>
	<variable name="grand_total" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{conducted}.equals( "Cancel")?new BigDecimal(0):$F{amount}]]></variableExpression>
	</variable>
	<group name="grand_total">
		<groupHeader>
			<band/>
		</groupHeader>
		<groupFooter>
			<band height="50">
				<line>
					<reportElement mode="Opaque" x="0" y="16" width="555" height="1" forecolor="#A6A6A6"/>
				</line>
				<staticText>
					<reportElement x="217" y="2" width="84" height="16"/>
					<textElement textAlignment="Right">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[Grand Total:]]></text>
				</staticText>
				<textField>
					<reportElement x="301" y="2" width="75" height="16"/>
					<textElement textAlignment="Right">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{grand_total}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="hospitalName">
		<groupExpression><![CDATA[$F{hospital_name}]]></groupExpression>
		<groupHeader>
			<band height="19">
				<staticText>
					<reportElement x="1" y="3" width="80" height="16"/>
					<textElement>
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[Hospital Name:]]></text>
				</staticText>
				<textField>
					<reportElement x="80" y="3" width="208" height="16"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{hospital_name}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="19">
				<line>
					<reportElement mode="Opaque" x="0" y="2" width="555" height="1" forecolor="#A6A6A6"/>
				</line>
				<line>
					<reportElement mode="Opaque" x="0" y="18" width="555" height="1" forecolor="#A6A6A6"/>
				</line>
				<staticText>
					<reportElement x="66" y="3" width="236" height="16"/>
					<textElement textAlignment="Right">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<text><![CDATA[total:]]></text>
				</staticText>
				<textField>
					<reportElement x="66" y="3" width="208" height="16"/>
					<textElement textAlignment="Right">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{hospital_name}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="301" y="3" width="75" height="16"/>
					<textElement textAlignment="Right">
						<font isBold="true" pdfFontName="Helvetica-Bold"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{hosp_sub_total}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band/>
	</background>
	<title>
		<band height="32">
			<staticText>
				<reportElement x="0" y="0" width="555" height="16"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[InComing Test Summary-Hospital wise]]></text>
			</staticText>
			<staticText>
				<reportElement x="278" y="16" width="10" height="16"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="false" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[To :]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="219" y="16" width="60" height="16"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="false" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{fromDate}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement x="287" y="16" width="59" height="16"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="false" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{toDate}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band/>
	</pageHeader>
	<columnHeader>
		<band height="40">
			<line>
				<reportElement mode="Opaque" x="0" y="21" width="555" height="1"/>
			</line>
			<line>
				<reportElement mode="Opaque" x="0" y="39" width="555" height="1"/>
			</line>
			<staticText>
				<reportElement x="1" y="24" width="85" height="16"/>
				<textElement>
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Date]]></text>
			</staticText>
			<staticText>
				<reportElement x="86" y="24" width="215" height="16"/>
				<textElement>
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Patient Name]]></text>
			</staticText>
			<staticText>
				<reportElement x="301" y="24" width="75" height="16"/>
				<textElement textAlignment="Right">
					<font isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="5" width="544" height="16"/>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Note: Report is based on in coming sample reg. date and amount which are not showing those are cancel tests.]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="18">
			<textField>
				<reportElement x="0" y="2" width="86" height="16"/>
				<textElement/>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{date}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="86" y="2" width="215" height="16"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{patient_name}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="301" y="2" width="75" height="16">
					<printWhenExpression><![CDATA[$F{conducted}.equals( "Cancel" )?Boolean.FALSE:Boolean.TRUE]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{amount}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band/>
	</pageFooter>
	<summary>
		<band/>
	</summary>
	<noData>
		<band height="50">
			<staticText>
				<reportElement x="0" y="0" width="555" height="50"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[No data found for the given search criteria]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
