<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ICDPatientReport" pageWidth="680" pageHeight="842" columnWidth="620" leftMargin="30" rightMargin="30" topMargin="40" bottomMargin="40">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<parameter name="condition" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT  pd.mr_no, sm.salutation,sm.salutation_id, pd.patient_name,  pd.last_name,  pd.patient_gender,
pd.patient_phone, pd.oldmrno,  pd.patient_address, ci.city_name as cityName, pd.patient_city, pd.country,
st.state_name as statename, pd.patient_state, pd.patient_area, pd.dateofbirth, pd.patient_care_oftext,pd.remarks,
pd.patient_source_category,pd.patient_category,
coalesce(pd.dateofbirth, pd.expected_dob) as expected_dob,  get_patient_age(pd.dateofbirth, pd.expected_dob) as age,
get_patient_age_in(pd.dateofbirth, pd.expected_dob) as agein,  pd.patient_careof_address, pd.relation, pd.custom_field1,
pd.custom_field2, pd.custom_field3 ,  pra.visit_type, pra.patient_id, pra.revisit, pra.reg_date, pra.reg_time,
pra.tpa_id, pra.insurance_id, pra.insurance_amt,  pra.patient_care_oftext as patcontactperson,
pra.relation as patrelation,  pra.patient_careof_address as pataddress,  pra.doctor, dr.doctor_name,
pra.dept_name AS dept_id, dep.dept_name, pra.org_id, od.org_name,  pra.bed_type as bill_bed_type,
pra.ward_name as reg_ward_name,  bn.bed_name as alloc_bed_name, bn.bed_type as alloc_bed_type,
wn.ward_name as alloc_ward_name,  tpa.tpa_name, ins.approved_amt,  pra.discharge_doc_id as dis_doc_id,
pra.discharge_format as dis_format, pra.discharge_flag,  pra.discharge_doctor_id, pra.discharge_date,
pra.discharge_time, pra.mlc_status,
pra.discharge_finalized_date as dis_finalized_date,  pra.discharge_finalized_time as dis_finalized_time,
pra.discharge_finalized_user as dis_finalized_user,  b.bill_no, b.status, pra.reference_docto_id,
dtm.discharge_type,  COALESCE(drs.doctor_name, rd.referal_name) as refdoctorname ,
pra.status as visit_status,icd.complaint_icd,icd.diagnosis_icd,icd.treatment_icd
FROM patient_registration pra  JOIN patient_details pd ON (pra.mr_no=pd.mr_no)
LEFT JOIN discharge_type_master dtm ON(dtm.discharge_type_id = pr.discharge_type_id)
LEFT OUTER JOIN salutation_master sm ON (pd.salutation = sm.salutation_id)
LEFT OUTER JOIN city ci ON (pd.patient_city=ci.city_id)
LEFT OUTER JOIN state_master st ON (pd.patient_state=st.state_id)
LEFT OUTER JOIN department dep ON (pra.dept_name = dep.dept_id)
LEFT OUTER JOIN doctors dr on (dr.doctor_id = pra.doctor)
LEFT OUTER JOIN ip_bed_details ibd on (ibd.patient_id = pra.patient_id )
and (ibd.status ='A' or ibd.status = 'C')
LEFT OUTER JOIN bed_names bn on (bn.bed_id = ibd.bed_id)
LEFT OUTER JOIN ward_names wn on (wn.ward_no = bn.ward_no )
LEFT OUTER JOIN organization_details od on (pra.org_id = od.org_id)
LEFT OUTER JOIN tpa_master tpa on (tpa.tpa_id = pra.tpa_id)
LEFT OUTER JOIN insurance_case ins on (pra.insurance_id = ins.insurance_id)
LEFT OUTER JOIN doctors drs on (pra.reference_docto_id = drs.doctor_id )
LEFT OUTER JOIN referral rd on (pra.reference_docto_id = rd.referal_no )
LEFT OUTER JOIN bill b ON (b.visit_id = pra.patient_id
AND b.bill_type = 'C' AND b.status != 'C' AND b.status != 'X')
RIGHT OUTER JOIN icd_ext_view icd on icd.visit_id=pra.patient_id $P!{condition}]]>
	</queryString>
	<field name="mr_no" class="java.lang.String"/>
	<field name="patient_id" class="java.lang.String"/>
	<field name="patient_name" class="java.lang.String"/>
	<field name="dept_name" class="java.lang.String"/>
	<field name="doctor_name" class="java.lang.String"/>
	<field name="diagnosis_icd" class="java.lang.String"/>
	<field name="treatment_icd" class="java.lang.String"/>
	<background>
		<band/>
	</background>
	<title>
		<band height="50">
			<staticText>
				<reportElement key="staticText" x="0" y="0" width="620" height="50"/>
				<box>
					<topPen lineWidth="0.25" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="28" isBold="true"/>
				</textElement>
				<text><![CDATA[ICD Report]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band height="15"/>
	</pageHeader>
	<columnHeader>
		<band height="14">
			<staticText>
				<reportElement key="element-90" x="0" y="0" width="55" height="14"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[MRNo]]></text>
			</staticText>
			<staticText>
				<reportElement key="element-90" x="55" y="0" width="55" height="14"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Patient Id]]></text>
			</staticText>
			<staticText>
				<reportElement key="element-90" x="110" y="0" width="70" height="14"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Patient Name]]></text>
			</staticText>
			<staticText>
				<reportElement key="element-90" x="180" y="0" width="70" height="14"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Doctor]]></text>
			</staticText>
			<staticText>
				<reportElement x="250" y="0" width="180" height="14"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement/>
				<text><![CDATA[Diagnosis ICD]]></text>
			</staticText>
			<staticText>
				<reportElement x="430" y="0" width="190" height="14"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.25" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement/>
				<text><![CDATA[Treatment ICD]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="15">
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement key="textField" x="0" y="0" width="55" height="15"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="8" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{mr_no}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="textField" x="55" y="0" width="55" height="15"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{patient_id}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement key="textField" x="110" y="0" width="70" height="15"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="8" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{patient_name}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement key="textField" x="250" y="0" width="180" height="15"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="8" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{diagnosis_icd}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement key="textField" x="180" y="0" width="70" height="15"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="8" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{doctor_name}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement key="textField" x="430" y="0" width="190" height="15"/>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="8" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{treatment_icd}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band height="27">
			<textField pattern="" isBlankWhenNull="false">
				<reportElement key="textField" x="410" y="6" width="170" height="19"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right">
					<font size="10" pdfFontName="Helvetica"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Page " + $V{PAGE_NUMBER} + " of "]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" pattern="" isBlankWhenNull="false">
				<reportElement key="textField" x="584" y="6" width="36" height="19" forecolor="#000000" backcolor="#FFFFFF"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
					<font size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="CP1252" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["" + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement key="textField" x="1" y="6" width="209" height="19"/>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement>
					<font size="10" pdfFontName="Helvetica"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[new Date()]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band/>
	</summary>
</jasperReport>
