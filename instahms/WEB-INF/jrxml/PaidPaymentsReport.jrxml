<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report name" pageWidth="678" pageHeight="842" whenNoDataType="NoDataSection" columnWidth="638" leftMargin="20" rightMargin="20" topMargin="40" bottomMargin="40">
	<parameter name="fromDate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="toDate" class="java.util.Date" isForPrompting="false"/>
	<parameter name="filterBy" class="java.lang.String" isForPrompting="false"/>
	<parameter name="groupBy" class="java.lang.String" isForPrompting="false"/>
	<parameter name="filterByName" class="java.lang.String" isForPrompting="false"/>
	<parameter name="groupByName" class="java.lang.String" isForPrompting="false"/>
	<parameter name="filterValue" class="java.lang.String" isForPrompting="false"/>
	<parameter name="counterValue" class="java.lang.String" isForPrompting="false"/>
	<parameter name="extraFilter" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT * , $P!{groupBy} as groupBy,
		description,category,amount,counter_no
		FROM ( select voucher_no, date,p.payee_name,case when voucher_category='R' then 'Payment Reversal' ELSE 'Payments' END as 		voucher_category, p.payment_mode_id, pmn.payment_mode, p.card_type_id, ctm.card_type,
			case when payment_type='D' then 'Cond Doctor Payments'
			when payment_type='C' then  'Misc Payments'
			when payment_type in ('R','F') then 'Ref Doctor Payments'
			when payment_type='P' then 'Presc Doctor Payments'
			when payment_type='S' then 'Supplier Payments'
			when payment_type='O' then 'OutHouse Payments' end as payment_type_names,
			mod_time,counter_no, counter ,payee_id as payeeid , bank, reference_no
		FROM payments p
			join payment_mode_master pmn on (p.payment_mode_id=pmn.mode_id)
			left join card_type_master ctm on (p.card_type_id = ctm.card_type_id)
			join payeenames_view pv on (pv.payee_id=p.payee_name) join counters c on c.counter_id=p.counter  )as payee
			join payments_details pd on pd.voucher_no=payee.voucher_no
		WHERE date(date) between $P{fromDate} and $P{toDate}
		AND ( ($P{filterValue} = '*')
		OR ($P!{filterBy} = $P{filterValue}) OR ($P{filterValue} = '' AND $P!{filterBy} IS NULL) )
		AND (($P{counterValue}= '*') OR (counter = $P{counterValue}))
		$P!{extraFilter}
		ORDER BY groupBy]]>
	</queryString>
	<field name="voucher_no" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="amount" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="date" class="java.sql.Timestamp">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="payment_mode" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="payeename" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="mod_time" class="java.sql.Timestamp">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="voucher_category" class="java.lang.String"/>
	<field name="payeeid" class="java.lang.String"/>
	<field name="payment_type_names" class="java.lang.String"/>
	<field name="groupBy" class="java.lang.String"/>
	<field name="description" class="java.lang.String"/>
	<field name="category" class="java.lang.String"/>
	<field name="counter_no" class="java.lang.String"/>
	<field name="bank" class="java.lang.String"/>
	<field name="reference_no" class="java.lang.String"/>
	<field name="card_type" class="java.lang.String"/>
	<variable name="groupby_sum" class="java.math.BigDecimal" resetType="Group" resetGroup="groupBy" calculation="Sum">
		<variableExpression><![CDATA[$F{amount}]]></variableExpression>
	</variable>
	<variable name="grandtotal" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{amount}]]></variableExpression>
	</variable>
	<variable name="countertotal" class="java.math.BigDecimal" resetType="Group" resetGroup="counter" calculation="Sum">
		<variableExpression><![CDATA[$F{amount}]]></variableExpression>
	</variable>
	<group name="grandtotal">
		<groupFooter>
			<band height="20">
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="561" y="0" width="76" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{grandtotal}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="461" y="0" width="100" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<text><![CDATA[Total Amount]]></text>
				</staticText>
			</band>
		</groupFooter>
	</group>
	<group name="counter">
		<groupExpression><![CDATA[$F{counter_no}]]></groupExpression>
		<groupHeader>
			<band height="15">
				<staticText>
					<reportElement x="0" y="0" width="63" height="15"/>
					<textElement verticalAlignment="Middle"/>
					<text><![CDATA[Counter By :]]></text>
				</staticText>
				<textField>
					<reportElement x="63" y="0" width="177" height="15"/>
					<textElement verticalAlignment="Middle"/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{counter_no}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="15">
				<textField>
					<reportElement x="582" y="0" width="55" height="15"/>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{countertotal}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="368" y="0" width="193" height="15"/>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{counter_no} + "   Total"]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="groupBy">
		<groupExpression><![CDATA[$F{groupBy}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="123" y="0" width="279" height="20"/>
					<textElement verticalAlignment="Middle"/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{groupBy}==null?"(NO"+$P{groupByName}+")":$F{groupBy}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="0" y="0" width="123" height="20"/>
					<textElement verticalAlignment="Middle"/>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{groupByName}  +" : "]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="20">
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="582" y="0" width="55" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{groupby_sum}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="379" y="0" width="182" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle"/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{groupBy}+"   Total"]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band/>
	</background>
	<pageHeader>
		<band height="50">
			<textField>
				<reportElement x="0" y="0" width="555" height="30"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="15"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Paid Payments Report "]]></textFieldExpression>
			</textField>
			<textField pattern="dd-MM-yyyy">
				<reportElement x="198" y="30" width="75" height="20"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{fromDate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="156" y="30" width="42" height="20"/>
				<textElement verticalAlignment="Middle"/>
				<text><![CDATA[From:]]></text>
			</staticText>
			<textField pattern="dd-MM-yyyy">
				<reportElement x="297" y="30" width="67" height="20"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$P{toDate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="273" y="30" width="24" height="20"/>
				<textElement verticalAlignment="Middle"/>
				<text><![CDATA[To:]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="18">
			<staticText>
				<reportElement x="0" y="0" width="55" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Voucher No]]></text>
			</staticText>
			<staticText>
				<reportElement x="170" y="0" width="126" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Description]]></text>
			</staticText>
			<staticText>
				<reportElement x="296" y="0" width="68" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Paid Date]]></text>
			</staticText>
			<staticText>
				<reportElement x="364" y="0" width="60" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Mode]]></text>
			</staticText>
			<staticText>
				<reportElement x="582" y="0" width="55" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="55" y="0" width="115" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{groupByName}.equalsIgnoreCase("Payee Name")?"Payment Type":
$P{groupByName}.equalsIgnoreCase("Payment Type")?"Payee Name":
$P{groupByName}.equalsIgnoreCase("Voucher Category")?"Payee Name":"None"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="508" y="0" width="78" height="18"/>
				<box>
					<topPen lineWidth="0.5" lineStyle="Solid"/>
					<bottomPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<text><![CDATA[Bank / Ref no]]></text>
			</staticText>
			<staticText>
				<reportElement x="425" y="0" width="60" height="18"/>
				<textElement verticalAlignment="Middle"/>
				<text><![CDATA[Card Type]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="18">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="0" y="0" width="55" height="18"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{voucher_no}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="55" y="0" width="115" height="18"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{groupByName}.equalsIgnoreCase("Payee Name")?$F{payment_type_names}:
$P{groupByName}.equalsIgnoreCase("Payment Type")?$F{payeename}:
$P{groupByName}.equalsIgnoreCase("Voucher Category")?$F{payeename}:"None"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="170" y="0" width="126" height="18"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{description}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="dd-MM-yyyy" isBlankWhenNull="true">
				<reportElement x="296" y="0" width="68" height="18"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{date}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="364" y="0" width="60" height="18"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{payment_mode}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="582" y="0" width="55" height="18"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{amount}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="508" y="0" width="78" height="18"/>
				<textElement verticalAlignment="Middle">
					<font size="9" pdfFontName="Helvetica"/>	
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[($F{bank}==null?"":$F{bank})+" "+($F{reference_no}==null?"":" / "+$F{reference_no})]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="425" y="0" width="79" height="18"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{card_type}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band/>
	</pageFooter>
	<summary>
		<band/>
	</summary>
	<noData>
		<band height="50">
			<staticText>
				<reportElement x="0" y="0" width="555" height="50"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="20"/>
				</textElement>
				<text><![CDATA[NO DATA FOUND FOR THE GIVEN SEARCH CRITERIA]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
